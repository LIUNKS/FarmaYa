<!-- admin/productos.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Productos - Farmacia Mery Salud</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background-color: #f5f5f5;
        }
        
        .sidebar {
            background: #343a40;
            min-height: 100vh;
            padding: 20px 0;
            position: fixed;
            width: 16.666667%;
        }
        
        .sidebar .nav-link {
            color: #adb5bd;
            padding: 10px 20px;
            margin: 5px 0;
            cursor: pointer;
        }
        
        .sidebar .nav-link:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        
        .sidebar .nav-link.active {
            color: white;
            background: #007bff;
        }
        
        .top-navbar {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px;
        }
        
        .content-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .product-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
        }

        .main-content {
            margin-left: 16.666667%;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner-border-lg {
            width: 3rem;
            height: 3rem;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="text-center">
            <div class="spinner-border spinner-border-lg text-light" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="text-white mt-3">Cargando...</p>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 p-0 sidebar">
                <div class="text-center text-white py-3">
                    <i class="fas fa-clinic-medical fa-2x mb-2"></i>
                    <h5>Farmacia Admin</h5>
                </div>
                <nav class="nav flex-column">
                    <a class="nav-link" href="./dashboard.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link active" href="./productos.html">
                        <i class="fas fa-pills"></i> Productos
                    </a>
                    <a class="nav-link" href="./pedidos.html">
                        <i class="fas fa-shopping-cart"></i> Pedidos
                    </a>
                    <a class="nav-link" href="./usuarios.html">
                        <i class="fas fa-users"></i> Usuarios
                    </a>
                    <a class="nav-link" href="./perfil.html">
                        <i class="fas fa-user-cog"></i> Mi Perfil
                    </a>
                    <hr class="bg-secondary">
                    <a class="nav-link" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 main-content pt-4">
                <!-- Top Bar -->
                <div class="top-navbar">
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="h3 mb-3 fw-bold">
                            <i class="fas fa-pills text-success"></i> Gestión de Productos
                        </h1>
                        <div>
                            <span class="badge bg-secondary">
                                <i class="fas fa-user"></i> <span id="adminName">Admin</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Content -->
                <div class="p-4">
                    <div class="content-card">
                        <!-- Stats -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <h6 class="card-title">Total Productos</h6>
                                        <h3 id="totalProducts">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h6 class="card-title">Productos Activos</h6>
                                        <h3 id="activeProducts">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-white">
                                    <div class="card-body">
                                        <h6 class="card-title">Stock Bajo</h6>
                                        <h3 id="lowStock">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-danger text-white">
                                    <div class="card-body">
                                        <h6 class="card-title">Sin Stock</h6>
                                        <h3 id="outOfStock">0</h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div class="d-flex gap-2">
                                <input type="text" class="form-control" id="searchProduct" 
                                       placeholder="Buscar por nombre o categoría..." style="width: 300px;">
                                <select class="form-select" id="filterCategory" style="width: 200px;">
                                    <option value="">Todas las categorías</option>
                                </select>
                            </div>
                            <button class="btn btn-success" id="btnNuevoProducto">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </button>
                        </div>

                        <!-- Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Imagen</th>
                                        <th>SKU</th>
                                        <th>Nombre</th>
                                        <th>Categoría</th>
                                        <th>Precio</th>
                                        <th>Stock</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTable">
                                    <tr>
                                        <td colspan="9" class="text-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Producto -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Nuevo Producto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Alert container -->
                    <div id="modalAlertContainer"></div>

                    <form id="productForm">
                        <input type="hidden" id="productId">
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Nombre del Producto *</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">SKU</label>
                                    <input type="text" class="form-control" id="productSku" 
                                           placeholder="PROD-001">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Categoría *</label>
                                    <select class="form-select" id="productCategory" required>
                                        <option value="">Seleccionar categoría</option>
                                        <option value="Analgésicos">Analgésicos</option>
                                        <option value="Vitaminas">Vitaminas</option>
                                        <option value="Primeros Auxilios">Primeros Auxilios</option>
                                        <option value="Protección">Protección</option>
                                        <option value="Equipos">Equipos</option>
                                        <option value="Medicamentos">Medicamentos</option>
                                        <option value="Gastroenterología">Gastroenterología</option>
                                        <option value="Respiratorio">Respiratorio</option>
                                        <option value="Antivirales">Antivirales</option>
                                        <option value="Dermatología">Dermatología</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Presentación</label>
                                    <input type="text" class="form-control" id="productPresentation" 
                                           placeholder="Ej: Caja x 10 tabletas">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Precio (S/.) *</label>
                                    <input type="number" class="form-control" id="productPrice" 
                                           step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Stock *</label>
                                    <input type="number" class="form-control" id="productStock" 
                                           min="0" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Estado</label>
                                    <select class="form-select" id="productStatus">
                                        <option value="true">Activo</option>
                                        <option value="false">Inactivo</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Principio Activo</label>
                            <input type="text" class="form-control" id="productPrincipioActivo" 
                                   placeholder="Ej: PARACETAMOL">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Descripción</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">URL de Imagen</label>
                            <input type="text" class="form-control" id="productImage" 
                                   placeholder="/img_1.png">
                            <small class="text-muted">Ruta relativa de la imagen (ej: /img_1.png)</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveBtn">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts - ORDEN IMPORTANTE -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/api-config.js"></script>
    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/app.js"></script>
    
    <script>
        
        // Variables globales
        let productos = [];
        let productosFiltrados = [];
        let productModal;

        // Verificar autenticación al cargar
        document.addEventListener('DOMContentLoaded', async function() {
            
            // Verificar sesión
            const token = localStorage.getItem('accessToken');
            const usuario = localStorage.getItem('usuarioActual');
            
            if (!token || !usuario) {
                showNotification('Sesión no encontrada. Redirigiendo al login...', 'warning');
                setTimeout(() => window.location.href = '/login.html', 2000);
                return;
            }

            const userData = JSON.parse(usuario);
            
            // Verificar que sea ADMIN
            if (userData.rol !== 'ADMIN') {
                showNotification('Acceso denegado. Solo administradores pueden acceder a esta sección.', 'danger');
                setTimeout(() => window.location.href = '/index.html', 2000);
                return;
            }

            // Mostrar nombre del admin
            document.getElementById('adminName').textContent = userData.nombre;

            // Inicializar modal
            productModal = new bootstrap.Modal(document.getElementById('productModal'));

            // Configurar event listeners
            setupEventListeners();

            // Cargar productos desde el backend
            await loadProducts();

            // Cargar categorías para el filtro
            loadCategories();
        });

        // Configurar todos los event listeners
        function setupEventListeners() {
            // Búsqueda y filtros
            document.getElementById('searchProduct').addEventListener('input', filterProducts);
            document.getElementById('filterCategory').addEventListener('change', filterProducts);

            // Botón nuevo producto
            document.getElementById('btnNuevoProducto').addEventListener('click', openNewProductModal);

            // Botón guardar en modal
            document.getElementById('saveBtn').addEventListener('click', saveProduct);

            // Botón logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
        }

        // Mostrar/ocultar loading overlay
        function showLoading(show = true) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Mostrar alertas en el modal
        function showModalAlert(message, type = 'danger') {
            const container = document.getElementById('modalAlertContainer');
            container.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'danger' ? 'exclamation-circle' : 'check-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        // Mostrar notificación toast
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 10000; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        // Cargar productos desde el backend
        async function loadProducts() {
            try {
                showLoading(true);
                
                productos = await ProductAPI.getAllProducts();
                productosFiltrados = productos;
                
                renderProducts();
                updateStats();
                showLoading(false);
            } catch (error) {
                console.error('✗ Error al cargar productos:', error);
                showLoading(false);
                
                const tbody = document.getElementById('productsTable');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-danger">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Error al cargar productos: ${error.message}
                            <br>
                            <small>Verifica que el backend esté corriendo en http://localhost:8080</small>
                        </td>
                    </tr>
                `;
            }
        }

        // Renderizar productos en la tabla
        function renderProducts() {
            const tbody = document.getElementById('productsTable');
            
            if (productosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted">
                            <i class="fas fa-inbox"></i> No se encontraron productos
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = productosFiltrados.map(producto => {
                const imagenUrl = producto.imageUrl 
                    ? `../assets/images${producto.imageUrl}` 
                    : 'https://via.placeholder.com/50?text=Sin+Imagen';
                
                return `
                    <tr>
                        <td>${producto.id}</td>
                        <td>
                            <img src="${imagenUrl}" 
                                 class="product-img" 
                                 alt="${producto.name}"
                                 onerror="this.src='https://via.placeholder.com/50?text=Error'">
                        </td>
                        <td>${producto.sku || '-'}</td>
                        <td>${producto.name}</td>
                        <td><span class="badge bg-secondary">${producto.categoria}</span></td>
                        <td class="fw-bold">S/. ${producto.price.toFixed(2)}</td>
                        <td>
                            <span class="badge ${getStockBadgeClass(producto.stock)}">
                                ${producto.stock}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${producto.activo ? 'bg-success' : 'bg-danger'}">
                                ${producto.activo ? 'Activo' : 'Inactivo'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editProduct(${producto.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${producto.id})" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Obtener clase de badge según el stock
        function getStockBadgeClass(stock) {
            if (stock === 0) return 'bg-danger';
            if (stock < 10) return 'bg-warning text-dark';
            return 'bg-success';
        }

        // Actualizar estadísticas
        function updateStats() {
            document.getElementById('totalProducts').textContent = productos.length;
            document.getElementById('activeProducts').textContent = 
                productos.filter(p => p.activo).length;
            document.getElementById('lowStock').textContent = 
                productos.filter(p => p.stock > 0 && p.stock < 10).length;
            document.getElementById('outOfStock').textContent = 
                productos.filter(p => p.stock === 0).length;
        }

        // Cargar categorías únicas para el filtro
        function loadCategories() {
            const categoriasSet = new Set(productos.map(p => p.categoria));
            const select = document.getElementById('filterCategory');
            
            // Limpiar opciones excepto la primera
            select.innerHTML = '<option value="">Todas las categorías</option>';
            
            Array.from(categoriasSet).sort().forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                select.appendChild(option);
            });
        }

        // Filtrar productos
        function filterProducts() {
            const searchTerm = document.getElementById('searchProduct').value.toLowerCase();
            const selectedCategory = document.getElementById('filterCategory').value;
            
            productosFiltrados = productos.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(searchTerm) || 
                                     p.categoria.toLowerCase().includes(searchTerm) ||
                                     (p.sku && p.sku.toLowerCase().includes(searchTerm));
                const matchesCategory = !selectedCategory || p.categoria === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });
            
            renderProducts();
        }

        // Abrir modal para nuevo producto
        function openNewProductModal() {
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('modalTitle').textContent = 'Nuevo Producto';
            document.getElementById('modalAlertContainer').innerHTML = '';
            productModal.show();
        }

        // Editar producto
        async function editProduct(id) {
            try {
                showLoading(true);
                const producto = await ProductAPI.getProductById(id);
                showLoading(false);
                
                document.getElementById('productId').value = producto.id;
                document.getElementById('productName').value = producto.name;
                document.getElementById('productSku').value = producto.sku || '';
                document.getElementById('productCategory').value = producto.categoria;
                document.getElementById('productPresentation').value = producto.presentacion || '';
                document.getElementById('productPrice').value = producto.price;
                document.getElementById('productStock').value = producto.stock;
                document.getElementById('productStatus').value = producto.activo.toString();
                document.getElementById('productPrincipioActivo').value = producto.principioActivo || '';
                document.getElementById('productDescription').value = producto.description || '';
                document.getElementById('productImage').value = producto.imageUrl || '';
                
                document.getElementById('modalTitle').textContent = 'Editar Producto';
                document.getElementById('modalAlertContainer').innerHTML = '';
                productModal.show();
            } catch (error) {
                console.error('Error al cargar producto:', error);
                showLoading(false);
                showNotification('Error al cargar el producto: ' + error.message, 'danger');
            }
        }

        // Guardar producto (crear o actualizar)
        async function saveProduct() {
            
            // Limpiar alertas previas
            document.getElementById('modalAlertContainer').innerHTML = '';
            
            // Validar formulario
            const form = document.getElementById('productForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const id = document.getElementById('productId').value;
            const productData = {
                name: document.getElementById('productName').value.trim(),
                sku: document.getElementById('productSku').value.trim() || null,
                categoria: document.getElementById('productCategory').value,
                presentacion: document.getElementById('productPresentation').value.trim() || null,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                activo: document.getElementById('productStatus').value === 'true',
                principioActivo: document.getElementById('productPrincipioActivo').value.trim() || null,
                description: document.getElementById('productDescription').value.trim() || null,
                imageUrl: document.getElementById('productImage').value.trim() || null
            };
            
            try {
                // Deshabilitar botón mientras se procesa
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Guardando...';
                
                if (id) {
                    // Actualizar producto existente
                    await ProductAPI.updateProduct(id, productData);
                    showNotification('Producto actualizado exitosamente', 'success');
                } else {
                    // Crear nuevo producto
                    await ProductAPI.createProduct(productData);
                    showNotification('Producto creado exitosamente', 'success');
                }
                
                // Recargar productos
                await loadProducts();
                
                // Cerrar modal
                productModal.hide();
                form.reset();
                
            } catch (error) {
                console.error('Error al guardar producto:', error);
                showModalAlert('Error al guardar producto: ' + error.message, 'danger');
            } finally {
                // Restaurar botón
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Guardar';
            }
        }

        // Eliminar producto
        async function deleteProduct(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            if (window.App && window.App.confirmAction) {
                window.App.confirmAction(`¿Está seguro de eliminar el producto "${producto.name}"?\n\nEsta acción no se puede deshacer.`, async () => {
                    try {
                        showLoading(true);
                        await ProductAPI.deleteProduct(id);
                        showLoading(false);
                        
                        showNotification('Producto eliminado exitosamente', 'success');
                        await loadProducts();
                    } catch (error) {
                        console.error('Error al eliminar producto:', error);
                        showLoading(false);
                        showNotification('Error al eliminar producto: ' + error.message, 'danger');
                    }
                });
            } else {
                // Fallback si App no está disponible - usar modal básico
                showConfirmModal(`¿Está seguro de eliminar el producto "${producto.name}"?\n\nEsta acción no se puede deshacer.`, async () => {
                    try {
                        showLoading(true);
                        await ProductAPI.deleteProduct(id);
                        showLoading(false);
                        
                        showNotification('Producto eliminado exitosamente', 'success');
                        await loadProducts();
                    } catch (error) {
                        console.error('Error al eliminar producto:', error);
                        showLoading(false);
                        showNotification('Error al eliminar producto: ' + error.message, 'danger');
                    }
                });
            }
        }

        // Logout
        function logout() {
            if (window.App && window.App.confirmAction) {
                window.App.confirmAction('¿Desea cerrar sesión?', () => {
                    // Limpiar TODOS los datos de sesión
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('refreshToken');
                    localStorage.removeItem('usuarioActual');
                    localStorage.removeItem('userData');
                    sessionStorage.removeItem('adminUser');
                    
                    // Redirigir al login del admin
                    window.location.href = '/login.html';
                });
            } else {
                // Fallback si App no está disponible - usar modal básico
                showConfirmModal('¿Desea cerrar sesión?', () => {
                    // Limpiar TODOS los datos de sesión
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('refreshToken');
                    localStorage.removeItem('usuarioActual');
                    localStorage.removeItem('userData');
                    sessionStorage.removeItem('adminUser');
                    
                    // Redirigir al login del admin
                    window.location.href = '/login.html';
                });
            }
        }

        // Hacer las funciones globales para que los onclick funcionen
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.logout = logout;

        // Función de modal de confirmación como fallback
        function showConfirmModal(message, onConfirm) {
            // Crear modal si no existe
            let modal = document.getElementById('confirmModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'confirmModal';
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Confirmar</h5>
                            </div>
                            <div class="modal-body">
                                <p id="confirmMessage"></p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" id="confirmCancelBtn">Cancelar</button>
                                <button type="button" class="btn btn-primary" id="confirmOkBtn">Aceptar</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Eventos para los botones
                document.getElementById('confirmOkBtn').addEventListener('click', () => {
                    const bsModal = bootstrap.Modal.getInstance(modal);
                    bsModal.hide();
                    if (onConfirm) onConfirm();
                });
                
                document.getElementById('confirmCancelBtn').addEventListener('click', () => {
                    const bsModal = bootstrap.Modal.getInstance(modal);
                    bsModal.hide();
                });
            }
            
            // Actualizar mensaje
            document.getElementById('confirmMessage').textContent = message;
            
            // Mostrar modal
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
        }
    </script>
</body>
</html>